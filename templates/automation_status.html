{% extends "base.html" %}

{% block title %}Automation Status - Admin Panel{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="fw-bold text-gradient mb-2">ðŸ¤– Automation Status</h2>
                    <p class="text-muted">All background processes run automatically - no manual intervention required</p>
                </div>
                <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- System Status - Clean & Simple -->
    <div class="row g-4 mb-4">
        <!-- Overall Status Card -->
        <div class="col-lg-12">
            <div class="card shadow-lg border-0 status-card">
                <div class="card-body p-5 text-center">
                    <div class="status-icon mb-4">
                        <i class="fas fa-check-circle fa-5x text-success"></i>
                    </div>
                    <h1 class="display-4 fw-bold text-success mb-3">All Systems Operational</h1>
                    <p class="lead text-muted mb-4">Background automation is running smoothly</p>
                    
                    <!-- Quick Stats -->
                    <div class="row g-3 mt-4">
                        <div class="col-md-3">
                            <div class="stat-box">
                                <i class="fas fa-database text-primary fs-2 mb-2"></i>
                                <h3 class="fw-bold mb-0" id="questionCount">{{ question_count }}</h3>
                                <small class="text-muted">Total Questions</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-box">
                                <i class="fas fa-cloud text-info fs-2 mb-2"></i>
                                <h3 class="fw-bold mb-0" id="cloudStatus">
                                    <span class="badge bg-success">Synced</span>
                                </h3>
                                <small class="text-muted">Cloud Backup</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-box">
                                <i class="fas fa-cog fa-spin text-warning fs-2 mb-2"></i>
                                <h3 class="fw-bold mb-0">
                                    <span class="badge bg-success">Running</span>
                                </h3>
                                <small class="text-muted">Scheduler</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-box">
                                <i class="fas fa-robot text-success fs-2 mb-2"></i>
                                <h3 class="fw-bold mb-0">4</h3>
                                <small class="text-muted">Active Jobs</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- What's Running -->
    <div class="row g-4">
        <div class="col-lg-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                    <h5 class="mb-0">
                        <i class="fas fa-list-check me-2"></i>Automated Processes
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-tasks me-2"></i>Process</th>
                                    <th class="text-center"><i class="fas fa-clock me-2"></i>Frequency</th>
                                    <th class="text-center"><i class="fas fa-check-circle me-2"></i>Status</th>
                                    <th><i class="fas fa-info-circle me-2"></i>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <strong><i class="fas fa-cloud-upload-alt me-2 text-primary"></i>Cloud Sync</strong>
                                    </td>
                                    <td class="text-center"><span class="badge bg-primary">Every 12 hours</span></td>
                                    <td class="text-center"><span class="badge bg-success">Active</span></td>
                                    <td class="text-muted">Backs up questions to Supabase cloud database</td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong><i class="fas fa-search me-2 text-info"></i>Question Scraping</strong>
                                    </td>
                                    <td class="text-center"><span class="badge bg-info">Every 60 minutes</span></td>
                                    <td class="text-center"><span class="badge bg-success">Active</span></td>
                                    <td class="text-muted">Scrapes new questions from online sources</td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong><i class="fas fa-brain me-2 text-warning"></i>AI Classification</strong>
                                    </td>
                                    <td class="text-center"><span class="badge bg-warning">Every 30 minutes</span></td>
                                    <td class="text-center"><span class="badge bg-success">Active</span></td>
                                    <td class="text-muted">Uses BERT AI to analyze question difficulty</td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong><i class="fas fa-magic me-2 text-success"></i>Question Generation</strong>
                                    </td>
                                    <td class="text-center"><span class="badge bg-success">Every 6 hours</span></td>
                                    <td class="text-center"><span class="badge bg-success">Active</span></td>
                                    <td class="text-muted">Generates new questions using T5 AI model</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Note -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-info border-0 shadow-sm">
                <div class="d-flex align-items-center">
                    <i class="fas fa-info-circle fa-2x me-3"></i>
                    <div>
                        <h6 class="mb-1"><strong>Fully Automated System</strong></h6>
                        <p class="mb-0">All processes run automatically in the background. No manual intervention required. The system maintains itself 24/7.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Terminal Access (Collapsed) -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light border-bottom">
                    <h6 class="mb-0">
                        <a data-bs-toggle="collapse" href="#terminalInfo" class="text-decoration-none text-dark">
                            <i class="fas fa-terminal me-2"></i>Advanced: Manual Cloud Sync
                            <i class="fas fa-chevron-down float-end"></i>
                        </a>
                    </h6>
                </div>
                <div id="terminalInfo" class="collapse">
                    <div class="card-body bg-light">
                        <p class="mb-3"><strong>For immediate cloud backup (outside normal 12-hour schedule):</strong></p>
                        <div class="bg-dark text-light p-3 rounded font-monospace small">
                            cd F:\ai_aptitude_exam\project<br>
                            python standalone_cloud_sync.py
                        </div>
                        <small class="text-muted mt-2 d-block">
                            <i class="fas fa-info-circle me-1"></i>
                            Only use this for urgent manual syncs. The automatic sync runs every 12 hours.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.text-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
}

.status-card {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    transition: transform 0.3s ease;
}

.status-card:hover {
    transform: translateY(-5px);
}

.status-icon {
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.stat-box {
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s ease;
}

.stat-box:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.table tbody tr {
    transition: background-color 0.2s ease;
}

.table tbody tr:hover {
    background-color: #f8f9fa;
}

.card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
}
</style>

<script>
// Update question count from API
document.addEventListener('DOMContentLoaded', function() {
    // Initial count from server
    const initialCount = {{ question_count }};
    document.getElementById('questionCount').textContent = initialCount;
    
    // Optionally refresh count every 30 seconds
    setInterval(function() {
        fetch('/api/cloud_sync/status')
            .then(response => response.json())
            .then(data => {
                if (data.local_questions) {
                    document.getElementById('questionCount').textContent = data.local_questions;
                }
            })
            .catch(error => console.error('Error fetching count:', error));
    }, 30000);
});
</script>
{% endblock %}
